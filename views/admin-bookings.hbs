{{!-- Layout and Title --}}
{{!< layout index}}
<h1>{{title}}</h1>

{{!-- Booking Filter Form --}}
<form method="GET" action="/admin-bookings">
    <label for="startDate">Start Date:</label>
    <input type="date" name="startDate" required>

    <label for="endDate">End Date:</label>
    <input type="date" name="endDate" required>

    <button type="submit">Filter</button>
</form>

{{!-- Booking List --}}
{{#if bookings.length}}
    <table>
        <thead>
            <tr>
                <th>Booking ID</th>
                <th>Guest ID</th>
                <th>Room Number</th>
                <th>Adult Pax</th>
                <th>Kid Pax</th>
                <th>Room Type</th>
                <th>Check In</th>
                <th>Check Out</th>
                <th>Details</th>
                <th>Booking Status</th>
            </tr>
        </thead>
        <tbody>
            {{#each bookings}}
                <tr>
                    <td>{{this._id}}</td>
                    <td>{{this.guestID}}</td>
                    <td>{{this.roomNum}}</td>
                    <td>{{this.adultPax}}</td>
                    <td>{{this.kidPax}}</td>
                    <td>{{this.roomType}}</td>
                    <td>
                <script>
                    document.write(new Date("{{this.checkIn}}").toLocaleString('en-PH', { 
                        weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', 
                        hour: '2-digit', minute: '2-digit', hour12: true }));
                </script>
            </td>
                    <td>
                        <script>
                            document.write(new Date("{{this.checkOut}}").toLocaleString('en-PH', { 
                                weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', 
                                hour: '2-digit', minute: '2-digit', hour12: true }));
                        </script>
                    </td>
                    <td>
                        <a href="/admin-booking-details/{{this._id}}">View Details</a>
                        <a href="/admin-edit-booking/{{this._id}}">Edit</a>
                 <a href="javascript:void(0);" onclick="deleteBooking('{{this._id}}')" style="color: red; text-decoration: underline;">Delete</a>
                    </td>
                    <td>{{this.status}}</td>
                    <td>
                    {{#ifEquals this.status "Pending"}}
                    <form method="POST" action="/admin-done-booking/{{this._id}}" style="display:inline;">
                        <button 
                            type="submit" 
                            class="btn btn-success" 
                            onclick="return confirm('Are you sure you want to mark this booking as Done?');">
                            Done
                        </button>
                    </form>
                    {{else}}
                    <button type="button" class="btn btn-secondary" disabled>Completed</button>
                    {{/ifEquals}}
                    </td>
                </tr>
            {{/each}}
        </tbody>
    </table>
{{else}}
    <p>No bookings found for the selected date range.</p>
{{/if}}

<script>
    async function deleteBooking(bookingId) {
        if (confirm('Are you sure you want to delete this booking?')) {
            try {
                const response = await fetch(`/admin-delete-booking/${bookingId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    alert('Booking deleted successfully.');
                    window.location.reload(); // Reload the page to reflect changes
                } else {
                    alert('Failed to delete the booking.');
                }
            } catch (error) {
                console.error('Error deleting booking:', error);
                alert('An error occurred while trying to delete the booking.');
            }
        }
    }
</script>
